# Regis Waterlytics Co

The purpose of this project is to explore the HB 1051 data with a dual focus: on water leakage as well as water production by population size. The data can be obtained from the [CWCB Water Efficiency Data Portal](http://cowaterefficiency.com/unauthenticated_home) with permission. Once in the portal, all report years (2013-2017) were selected as well as all water providers.

## Getting Started

These instructions will get you a copy of the project up and running on your local machine.

### Prerequisites

[ArcGIS](https://www.arcgis.com/index.html) - for COWaterStations_v2.mxd to generate map visualzations

[R](https://www.r-project.org/) and [RStudio](https://www.rstudio.com/products/rstudio/download/). 

[Download and Install R and RStudio here](https://courses.edx.org/courses/UTAustinX/UT.7.01x/3T2014/56c5437b88fa43cf828bff5371c6a924/)

Once R and RStudio are installed, the following R packages are required:
* sqldf
* data.table
* dplyr
* tidyr
* ggplot2
* rlist
* lubridate  

Install and load these packages using the following commands in RStudio:
```
install.packages("<package_name>")
library(<package_name>)
```

### Installing/Downloading

* Download entire repository. 

**For .R and .rmd files:**
* Open .R and .rmd files with RStudio
* *Before executing any .R or .rmd files, be sure to update file paths for read and write operations to reflect your machine's file structure*
* For .R files:
    + Right-click Select All (or type Ctrl-A on Windows, or Command-A on Mac)
    + Click "Run current line or selection" in the script window menu (or type Ctrl-Alt-R on Windows, or Command-Option-R on Mac)
    + Output will display in RStudio Console
 * For .rmd files:
    + Click Knit (or type Ctrl-Shift-K on Windows or Command-Shift-K on Mac)
    
**For .kmz files:**
* Open the [Google Chrome Browser](https://www.google.com/chrome/) and navigate to [Google Earth](https://www.google.com/earth/)
* Click the 'Launch Google Earth' button
* Once loaded, click the menu in the top left of the screen
* From the menu select: My Places > Import KML File > Open File... (you may need to enable KML File Import in settings)
* Select and Open the .kmz file located on your machine. Google Earth will automatically orient to display the map.
* Navigate to various water stations, primary roads, counties, and states by expanding folders and double clicking the desired location
* For the COWaterStations3.kmz file, hide the tl_2018_08_place_CO folder from view by clicking the eye next to the folder name to see the underlying geography of municipalities

**For .mxd files:**
* Open ArcGIS
* In the menu ribbon at the top of the ArcGIS interface, select the Insert tab > Import Map
* Select and open the .mxd file of choice located on your machine

## File Descriptions

**AWWA Adherence Boxplot.pdf** - This file contains the boxplots generated by the Statistical Analysis Water Loss.R file showing that stations with AWWA adherence tend to have slightly higher water loss percentages

**ColoradoCDO_AnalyticsChallenge_Final_Submission_Regis Waterlytics Co_FINAL.pptx** - This file contains our final presentation submission for the Smart Data Analytics Challenge

**COWaterStations_v2.mxd** - This file was used with ArcGIS to generate a map of the water stations that supply water to Colorado. This file makes use of the DWR_Surface_Water_Stations2.csv data

**COWaterStations_v2.png** - This map shows the locations of all of the water stations that supply water throughout Colorado

**Files from Final GIS Files - Predicitons by County** - The basemaps and the graphs for the population and water prediction analysis at the county level were created by: (1) using national dataset for 2018 US Census Bureau Tigerline shapefiles (for primary roads or highways, counties, states), (2) adding them as feature classes into to feature datasets in a file geodatabase, (3) clipping them to size of the State of Colorado and transforming the map projection to ‘NAD 1983 UTM Zone 13N’, (4) adding the output files from the population and water prediction analysis (i.e. water_population_predictions_municipalities.csv and water_population_predictions_counties.csv) and creating the % difference calculation between 2020 and 2050 for both population and water predictions, (5) joining them to the county feature class, and (6) symbolizing and configuring the maps with additional annotations and graphs. The GIS files generated can be consumed by any mapping system, including ArcGIS to include: (1) shapefiles (zipped .shp files), (2) Map Files (.mxd, .pdf, .png), (3) Layer files (.lyr), (4) KMZ files (.kmz i.e. zipped .kml files). There are graphics files (.png) files referencing charts used alongside maps. These files map best when using NAD 1983 and specifically the following map projection: ‘NAD 1983 UTM Zone 13N’.
* **Final GIS Files - Predictions by County > Graphics Files** - This folder contians visualizations depicting population predictions and water predcitions up to the year 2050
* **Final GIS Files - Predictions by County > KMZ Files** - This folder contians .kmz files that visualize population predictions and water predictions. 
* **Final GIS Files - Predictions by County > Layer Files** - This folder contians .lyr files for use with ArcGIS map visualizations
* **Final GIS Files - Predictions by County > Map Files** - This folder contians .mxd files used to generate map visualizations using ArcGIS. It also contains some .png versions of these visualizations
* **Final GIS Files - Predictions by County > Shapefiles** - This folder contians various shapefiles for use with ArcGIS for creating map visualizations 

**leak2.rmd** & **leak2.pdf** -  The purpose of this file is to explore the HB 1051 data with emphasis on water leakage. Files were merged to create water leakage reporting by water provider and year. Data is displayed graphically and recommendations are provided for cleaning up potential reporting errors. The .rmd contains the raw markdown file, the pdf is just a printed version of this. This report uses foundational_09_balance_data.csv & overview.csv from the HB 1051 data

**Leaks, Pipes, Detection.R** - The purpose of this file is to explore correlations between percent water loss and given variables. Weak correlations are found between percent water loss and the percent of systems inspected for leaks annually and the age at which the provider replaces small meters, and no correlation is found between the other variables (percent of pipes replaced annually, number of years between large meter testing, whether the provider had implemented a meter testing program, and leak detection methods). This report uses foundational_06a_loss_and_leak_det.csv, LeakDetTypes.csv, PercentLossValuesNoOutliers.csv, & TotalLossYear.csv 

**meterGreaterDistributedChart.PNG**  - This chart shows which cities during which years have metered water greater than distributed water.

**ngrams.rmd** & **ngrams.pdf** - The purpose of this file is to conduct text analysis on the leak_detection_field_technology column in the foundational_06a_loss_and_leak_detection.csv file. Distributions of time between testing and age to replace small meters in years are shown. Recommendations for reporting are suggested to leverage this information. The .rmd file contains the raw markdown file, the pdf is just a printed version of this. This report uses foundation_06a_loss_and_leak_detection_technology.csv

**Statistical Analysis Water Loss.R** - The purpose of this file is to analyze how AWWA policy adherence relates to water loss. Percent water loss was calculated for each municipality.  Once the data was cleaned for outliers a Wilcoxon Rank Sum test was performed on percent water loss versus municipalities that were AWWA policy adherent on their potable treated water.  We found that municipalities that were AWWA policy adherent had significantly more percent water loss than municipalities that were not AWWA policy adherent. This report uses  billloss.csv, foundational_06a_loss_and_leak_det.csv, foundational_07_audit_info.csv, normalizing_03_population.csv, and waterloss.csv

**waterByCity.rmd** & **waterByCity.pdf** - The purpose of this file is to explore the HB 1051 data with an emphasis on population and water production projections. Files were merged and separated by water type (i.e. potable, non-potable raw, and non-potable reuse). A linear model was fit to potable water production by population served. Population data by county/municipality was used to create population projections by county and municipality until the year 2050. These projections were used to anticipate necessary potable water production per county and municipality until the year 2050. Output files include: water_population_predictions_counties.csv and water_population_predictions_municipalities.csv. This report uses historical-census-data-counties.csv, historical-census-data-municipalities.csv, normalizing_03_population.csv, overview.csv, & water_use_02_production.csv

**water_population_predictions_municipalities.csv** & **water_population_predictions_counties.csv** - These files contain the outputs of the waterByCity analyses, and include projected population numbers as well as projected potable water production needs (in millions of gallons) by municipality and county, respectively. *Note*: not all Colorado municipalities and counties are included in these files, only the ones that we had enough data to project population growth.

***Note:*** Any files not mentioned here are input files. See file descriptions for input files used.

## Built With

* [RStudio](https://www.rstudio.com/) - The IDE used to analyze all data and generate R Markdown files
* [ArcGIS](https://www.arcgis.com/index.html) - Used to generate map visualizations

## Authors

* **Cynthia Mann** - *Map Visualizations* - [jambel77](https://github.com/jambel77)
* **David Sciacca** - *Water Production Projection Model; README.md* - [dsciacca](https://github.com/dsciacca)
* **Kellen Sorauf** - *Population Projection Model; AWWA Adherance Analysis* - [Mrsnellek](https://github.com/Mrsnellek)
* **Lolita Mannik** - *Leak Analysis; Powerpoint Presentation* - [ChihuaWars](https://github.com/ChihuaWars)
* **Yekaterina Bardash** - *Leak Data Preparation and Analysis; N-grams Analysis* - [ybardashRegis](https://github.com/ybardashRegis)

See also the list of [contributors](https://github.com/ybardashRegis/regiswaterlyticsco/graphs/contributors) who participated in this project.

## Acknowledgments

* Thanks to the Colorado Governor’s Office of Information Technology for putting on the *Smart Data Analytics Challenge - Addressing Colorado’s Critical Issues*
* Thank you to Regis University for bringing our team together and to Professor Kellen Sorauf for advising our team.


